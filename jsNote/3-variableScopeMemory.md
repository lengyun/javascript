* 本章内容
  *  理解基本类型和引用类型的值
  *   理解执行环境
  *   理解垃圾收集

### 基本类型和引用类型的值

* 基本类型值

  简单的数据段。

  基本数据类型是按值访问的，可以操作保存在变量中的实际的值

* 引用类型值

  指那些可能由多个值构成的对象。

  引用类型的值是保存在内存中的对象，在操作对象时，实际上是在操作对象的引用而不是实际的对象。

* 动态属性

  引用类型的值，可以为其添加属性和方法，也可改变和删除其属性和方法。

  基本类型的值，不能添加属性。

* 复制变量值

  * 基本类型值会在变量对象上创建一个新值，然后把该值复制到为新变量分配的位置上。
  * 引用类型值同样会将存储在变量对象中的值复制到为新变量分配的空间中，不同的是这个值的副本实际上是一个指针，指向存储在堆中的一个对象。复制后两个变量实际上引用同一个对象。

* 传递参数

  函数的参数都是按值传递的，把函数外部的值复制给函数内部的参数，就和把值从一个变量复制到另一个变量一样。

  ```javascript
  function setName(obj) {
      obj.name = "Nicholas";
      obj = new Object();
      obj.name = "Greg";
  }
  var person = new Object();
  setName(person);
  alert(person.name); //"Nicholas"
  //函数内部引入对象后，给对象添加了name属性，反应在外部的person对象。
  //当在函数内部重写 obj 时，这个变量引用的就是一个局部对象了。而这个局部对象会在函数执行完毕后立即被销毁检测类型
  ```

* 检测类型

  `typeof` 操作符是确定一个变量是字符串、数值、布尔值，还是 undefined 的最佳工具

  `instanceof` 操作符检测引用类型的值是什么类型的对象。

  ```javascript
  alert(person instanceof Object)
  ```

  所有引用类型的值都是 Object 的实例

### 执行环境及作用域

执行环境（execution context）定义了变量或函数有权访问的其他数据，决定了他们各自的行为。每个执行环境都有一个与之关联的**变量对象**（variable object）环境中定义的所有变量和函数都保存在这个对象中。

某个执行环境中的所有代码执行完毕后，该环境被销毁，保存在其中的所有变量和函数定义也随之销毁。

每个函数都有自己的**执行环境** 。当执行流进入一个函数时，函数的环境就会被推入一个环境栈中。而在函数执行之后，栈将其环境弹出，把控制权返回给之前的执行环境。

当代码在一个环境中执行时，会创建变量对象的一个**作用域链**（scope chain）作用域链的用途是保证对执行环境有权访问的所有变量和函数的有序访问。作用域链的前端始终都是当前执行的代码所在环境的变量对象。

标识符解析是沿着作用域链一级一级地搜索标识符的过程。搜索过程始终从作用域链的前端开始，然后逐级地向后回溯，直至找到标识符为止

* 延长作用域链

  有些语句可以在作用域链的前端临时增加一个变量对象，该变量对象会在代码还行后被移除。

  *  try-catch 语句的 catch 块；
  *  with 语句

* 没有块级作用域

  由 for 语句创建的变量 i 即使在 for 循环执行结束后，也依旧会存在
  于循环外部的执行环境中

  * 变量声明

    var 声明的变量会自动被添加到最接近的环境中。在函数内部，最接近的环境就是函数的局部环境；在 with 语句中，最接近的环境是函数环境。如果初始化变量时没有使用 var 声明，该变量会自动被添加到全局环境。

  * 查询标识符

    当在某个环境中为了读取或写入而引用一个标识符时，必须通过搜索来确定该标识符实际代表什么。搜索过程从作用域链的前端开始，向上逐级查询与给定名字匹配的标识符。如果在局部环境中找到了该标识符，搜索过程停止，变量就绪。如果在局部环境中没有找到该变量名，则继续沿作用域链向上搜索。搜索过程将一直追溯到全局环境的变量对象。如果在全局环境中也没有找到这个标识符，则意味着该变量尚未声明。

### 垃圾收集

垃圾收集机制的原理：找出那些不再继续使用的变量，然后释放其占用的内存。

* 标记清理

  当变量进入环境（例如，在函数中声明一个变量）时，就将这个变量标记为“进入环境”。而当变量离开环境时，则将其标记为“离开环境”。

* 引用计数

  跟踪记录每个值被引用的次数。当声明了一个变量并将一个引用类型值赋给该变量时，则这个值的引用次数就是 1。如果同一个值又被赋给另一个变量，则该值的引用次数加 1。相反，如果包含对这个值引用的变量又取得了另外一个值，则这个值的引用次数减 1。当这个值的引用次数变成 0 时，则说明没有办法再访问这个值了，因而就可以将其占用的内存空间回收回来。

  **循环引用**指的是对象 A 中包含一个指向对象 B 的指针，而对象 B 中也包含一个指向对象 A 的引用。为了避免类似这样的循环引用问题，最好是在不使用它们的时候手工断开原生 JavaScript 对象与DOM 元素之间的连接

* 管理内存

  确保占用最少的内存可以让页面获得更好的性能。而优化内存占用的最佳方式，就是为执行中的代码只保存必要的数据。一旦数据不再有用，最好通过将其值设置为 null 来释放其引用——这个做法叫做**解除引用**（dereferencing）